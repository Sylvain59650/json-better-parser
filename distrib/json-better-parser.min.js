(function(a,b){if(typeof define==="function"&&define.amd){define(["exports"],b);}else if(typeof exports!=="undefined"){b(exports);}else{var c={exports:{}};b(c.exports);a.JSONEx=c.exports;}})(this,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:true});/* eslint no-loop-func: 0 *//* eslint-disable complexity */class g extends Error{}var h="";var i=0;var j=[];var k=0;var m=0;var l=null;var n=false;const o={isLetter:a=>a.match(/[A-Za-z]/),isDigit:a=>a.match(/[0-9]/),isWhitespace:a=>a.match(/\s/),isNewline:a=>a.match(/\n/),insert:(a,b)=>{h=h.slice(0,i)+a+h.slice(i);if(b){i+=b;}},replace:(a,b)=>{h=h.slice(0,i)+a+h.slice(i+1);if(b){i+=b;}},insertAtWord:a=>{h=h.slice(0,k)+a+h.slice(k);},remove:()=>{h=h.slice(0,i)+h.slice(i+1);i--;},removePreviousComma:()=>{if(h[i-1]===","){h=h.slice(0,i-1)+h.slice(i);i--;}},removeSpace:()=>{var a=h.length;while(i<a&&o.isWhitespace(h[i])){i++;}var b=h[i];m=i;return b;},pass(a){var b=i;while(a.indexOf(h[b])>=0){b++;}i=b;m=i;return h[b];},push:a=>{j.push(a);m=i;},pop:()=>{j.pop();m=i;},check:(a,b,c)=>{k=i;if(h.substr(i,a.length)===a){var d=h[i+a.length];if(d===","||d==="}"||d==="]"||d===" "){i+=a.length-1;return b;}i--;return c;}return c;},next:a=>{var b=h.length;while(i<b&&a.indexOf(h[i])===-1){i++;}return h[i];},insertAtEndWordPos:a=>{var b=i-1;while(b>=0&&o.isWhitespace(h[b])){b--;}b++;h=h.slice(0,b)+a+h.slice(b);i++;},lexical:function(a,b){var c=j[j.length-1];switch(a){case"start":b=o.removeSpace();if(b==="{"){o.push("obj");return"obj_awaiting_key";}break;case"obj_awaiting_key":b=o.removeSpace();if(b==="}"){o.removePreviousComma();o.pop();return"obj_complete";}if(b==="\""){return"obj_key_str";}if(b==="'"){o.replace("\"");return"obj_key_str_incorrect_quotes";}if(o.isLetter(b)||o.isDigit(b)||b==="-"){o.insert("\"",1);return"obj_key_str_missing_left_quote";}break;case"obj_key_str_missing_left_quote":b=o.next(":\"'");if(b===":"){m=i;o.insertAtEndWordPos("\"");return"obj_awaiting_value";}if(b==="\""){return"obj_awaiting_colon";}if(b==="'"){o.replace("\"",1);i--;return"obj_awaiting_colon";}break;case"obj_key_str_incorrect_quotes":if(b==="'"){o.replace("\"");return"obj_awaiting_colon";}break;case"obj_key_str":if(b==="\""){return"obj_awaiting_colon";}break;case"obj_awaiting_colon":if(b===":"){m=i;return"obj_awaiting_value";}break;case"obj_awaiting_value":b=o.removeSpace();if(b==="'"){o.replace("\"");return"obj_value_str_incorrect_quotes";}if(b==="{"){o.push("obj");return"obj_awaiting_key";}if(b==="["){o.push("arr");return"arr_stable";}if(b==="\""){return"obj_value_str";}if(o.isDigit(b)){return"obj_value_num";}if(b==="-"){return"obj_value_num";}if(b==="t"){return o.check("true","obj_stable","obj_missing_left_quote");}if(b==="f"){return o.check("false","obj_stable","obj_missing_left_quote");}if(b==="n"){return o.check("null","obj_stable","obj_missing_left_quote");}break;case"obj_missing_left_quote":o.insertAtWord("\"");return"obj_value_str_incorrect_quotes";case"obj_value_str":b=o.next("\"}");if(b==="\""){return"obj_stable";}if(b==="}"){o.insert("\"");o.pop();if(c==="obj"){return"obj_complete";}return"obj_stable";}break;case"obj_value_str_incorrect_quotes":b=o.next("',}");if(b==="'"){o.replace("\"");return"obj_stable";}if(b===","){o.insert("\"");return"obj_stable";}if(b==="}"){o.replace("\"}");o.pop();return"obj_complete";}break;case"obj_value_num":b=o.pass("0123456789.");b=o.removeSpace();if(b==="}"){o.pop();return"obj_complete";}if(b===","){return"obj_awaiting_key";}return"obj_value_num_error";case"obj_stable":m=i;b=o.next("},");if(b==="}"){o.pop();return"obj_complete";}if(b===","){return"obj_awaiting_key";}break;case"obj_complete":m=i;if(b==="]"){o.pop();return"arr_complete";}if(o.isNewline(b)){o.replace(",");if(c==="obj"){return"obj_awaiting_key";}return"arr_awaiting_value";}if(b===","){if(c==="obj"){return"obj_awaiting_key";}return"arr_awaiting_value";}break;case"arr_stable":m=i;if(o.isWhitespace(b)){o.remove();}if(b==="'"){o.replace("\"");return"arr_value_str_incorrect_quotes";}if(b==="{"){o.push("obj");return"obj_awaiting_key";}if(b==="["){o.push("arr");return"arr_stable";}if(b==="]"){o.pop();return"arr_complete";}if(b==="\""){return"arr_value_str";}if(o.isDigit(b)){return"arr_value_num";}if(b==="-"){return"arr_value_num";}if(b==="t"){return o.check("true","arr_stable","arr_error");}if(b==="f"){return o.check("false","arr_stable","arr_error");}if(b==="n"){return o.check("null","arr_stable","arr_error");}break;case"arr_awaiting_value":b=o.removeSpace();if(b==="'"){o.replace("\"");return"arr_value_str_incorrect_quotes";}if(b==="{"){o.push("obj");return"obj_awaiting_key";}if(b==="["){o.push("arr");return"arr_stable";}if(b==="]"){o.removePreviousComma();o.pop();return"arr_complete";}if(b==="\""){return"arr_value_str";}if(o.isDigit(b)){return"arr_value_num";}if(b==="-"){return"arr_value_num";}if(b==="t"){return o.check("true","arr_stable","arr_error");}if(b==="f"){return o.check("false","arr_stable","arr_error");}if(b==="n"){return o.check("null","arr_stable","arr_error");}break;case"arr_complete":m=i;if(b==="}"){o.pop();return"obj_complete";}if(o.isNewline(b)){if(c==="obj"){return"obj_awaiting_key";}return"arr_awaiting_value";}if(b===","){if(c==="obj"){return"obj_awaiting_key";}return"arr_awaiting_value";}break;case"arr_value_str":if(b==="\""){return"arr_stable";}break;case"arr_value_str_incorrect_quotes":if(b==="'"){o.replace("\"");return"arr_stable";}break;case"arr_value_num":b=o.pass("0123456789.");b=o.removeSpace();if(b==="]"){o.pop();return"arr_complete";}if(b===","){return"arr_awaiting_value";}break;default:break;}return a;},error(a,b){let c=20;const d=a.message.match(/^Unexpected token.*position\s+(\d+)/i);const e=d?Number(d[1]):a.message.match(/^Unexpected end of JSON.*/i)?b.length-1:null;var f=a.message;if(e!==null){const a=e<=c?0:e-c;const d=e+c>=b.length?b.length:e+c;var g=b.slice(a,d);f+=" while parsing near \n"+g+"\n"+"-".repeat(e)+"^";}else{f+=" while parsing "+b.slice(0,c*2);}return f;}};function b(a){let b="start";j=[];h=a;i=0;var c="";while(i<h.length){c=h[i];b=o.lexical(b,c);i++;}if(b!=="obj_complete"){var d=m-20<0?0:m-20;var e=m+20>=h.length?h.length:m+20;var f=h.substring(d,e)+"\n"+"-".repeat(20)+"^";throw new g("Error: Second chance: parse error at position "+i+" with state "+b+" after \n"+f);}return h;}function c(a){try{return l.parse(a);}catch(f){try{var c=b(a);return l.parse(c);}catch(b){var d=o.error(f,a)+"\n";if(b instanceof g){d+=b.message;}else{d+=o.error(b,c||"");}throw d;}}}function d(){if(!n){l=JSON;n=true;JSON=this;}}function e(){if(n){JSON=l;n=false;}}function f(a){return l.stringify(a);}l=JSON;a.parse=c;a.correct=b;a.stringify=f;a.revertToNativeJson=e;a.replaceNativeJson=d;});